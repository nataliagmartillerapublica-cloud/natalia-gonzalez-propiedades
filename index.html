<!--
  @file index.html
  @description Landing estática de NGespacios con:
   - Listado desde Google Sheets (CSV) integrado en la sección principal.
   - Galería modal con carrusel y botón “Ficha” (o descarga de PDF si está en el CSV).
   - Panel Admin oculto (sin botón), protegido con PIN (Valda2412). 5 intentos y bloqueo 5 min.
   - Tras “Probar” o “Guardar” la planilla, se cierra sesión admin automáticamente.
-->

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />

    <title>NGespacios — Inmobiliaria en Bariloche</title>
    <meta
      name="description"
      content="Venta, alquiler, tasaciones y acompañamiento personalizado en Bariloche."
    />
    <meta name="theme-color" content="#572d30" />

    <!-- Open Graph -->
    <meta property="og:title" content="NGespacios — Inmobiliaria en Bariloche" />
    <meta
      property="og:description"
      content="Venta, alquiler, tasaciones y acompañamiento personalizado en Bariloche."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/ea65a1b8-690c-4544-909e-d44a40ea8675.jpg"
    />

    <!-- Fuente -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Estilos de marca y accesibilidad -->
    <style>
      :root {
        --brand-bg: #f4f2f2;
        --brand-primary: #572d30;
        --brand-text: #363332;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: 'Montserrat', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
        color: var(--brand-text);
        background: var(--brand-bg);
        font-weight: 300;
        letter-spacing: 0.01em;
        margin: 0;
      }
      a:focus-visible,
      button:focus-visible,
      select:focus-visible,
      input:focus-visible,
      textarea:focus-visible {
        outline: 2px solid var(--brand-primary);
        outline-offset: 2px;
        border-radius: 6px;
      }
      .container-max {
        max-width: 72rem; /* ~6xl */
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </head>

  <body class="min-h-screen bg-[color:var(--brand-bg)] text-[color:var(--brand-text)]">
    <noscript>
      <div class="fixed inset-0 grid place-items-center p-6">
        <div
          class="rounded-xl border border-neutral-200 bg-white p-4 shadow-sm text-sm text-neutral-700"
        >
          Esta página utiliza JavaScript para la galería y el panel Admin.
        </div>
      </div>
    </noscript>

    <!-- Header -->
    <header
      class="sticky top-0 z-30 w-full border-b border-neutral-200 bg-[color:var(--brand-bg)]/90 backdrop-blur-md"
    >
      <div class="mx-auto container-max px-4 h-16 flex items-center justify-between">
        <a href="#" class="flex items-end gap-2" aria-label="NGespacios - Inicio">
          <div class="flex flex-col leading-none">
            <div
              class="h-9 w-9 md:h-10 md:w-10 rounded-[8px] bg-[color:var(--brand-primary)] grid place-items-center shadow-sm"
            >
              <span class="text-[color:var(--brand-bg)] font-light tracking-tight text-[15px] md:text-[16px]"
                >NG</span
              >
            </div>
            <span
              class="mt-0.5 text-[10px] tracking-[0.22em] text-[color:var(--brand-text)] font-light uppercase"
              >ESPACIOS</span
            >
          </div>
        </a>

        <!-- Navegación -->
        <nav class="hidden md:flex items-center gap-6 text-sm">
          <a href="#propiedades" class="hover:text-[color:var(--brand-primary)]">Propiedades</a>
          <a href="#tasacion" class="hover:text-[color:var(--brand-primary)]">Tasación</a>
          <a href="#contacto" class="hover:text-[color:var(--brand-primary)]">Contacto</a>
          <a
            href="#propiedades"
            class="rounded-lg bg-[color:var(--brand-primary)] px-4 py-2 text-white hover:opacity-90 transition-colors"
            >Ver propiedades</a
          >
        </nav>

        <!-- Botón móvil -->
        <button
          id="btn-mobile"
          class="md:hidden inline-flex h-9 w-9 items-center justify-center rounded-md border border-neutral-300 bg-white/70"
          aria-label="Abrir menú"
          aria-expanded="false"
          aria-controls="mobile-menu"
          type="button"
        >
          <i data-lucide="menu" class="h-4 w-4"></i>
        </button>
      </div>

      <!-- Menú móvil -->
      <div
        id="mobile-menu"
        class="md:hidden hidden border-t border-neutral-200 bg-[color:var(--brand-bg)]/95 backdrop-blur-md"
      >
        <div class="mx-auto container-max px-4 py-3">
          <div class="grid gap-2 text-sm">
            <a href="#propiedades" class="py-2 hover:text-[color:var(--brand-primary)]"
              >Propiedades</a
            >
            <a href="#tasacion" class="py-2 hover:text-[color:var(--brand-primary)]">Tasación</a>
            <a href="#contacto" class="py-2 hover:text-[color:var(--brand-primary)]">Contacto</a>
            <a
              href="#propiedades"
              class="mt-2 inline-flex w-full items-center justify-center rounded-lg bg-[color:var(--brand-primary)] px-4 py-2 text-white hover:opacity-90 transition-colors"
              >Ver propiedades</a
            >
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Hero -->
      <section class="relative isolate">
        <div class="absolute inset-0 -z-10">
          <img
            src="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/c0105bbf-bf3c-42e0-bc2b-88d39c05c4aa.jpg"
            alt="Lago en Bariloche"
            class="object-cover w-full h-full"
          />
          <div class="absolute inset-0 bg-[color:var(--brand-bg)] mix-blend-multiply opacity-30"></div>
          <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/45 to-black/30"></div>
        </div>

        <div class="mx-auto container-max px-4 py-16 md:py-24">
          <p class="text-[12px] sm:text-sm md:text-base text-white/90 font-light leading-snug">
            Natalia González • Martillera y Corredora Pública • MAT. Nº377- RP-21 Fº456 TºII
          </p>

          <h1 class="mt-3 text-3xl md:text-5xl font-medium tracking-tight text-white">
            Tu próximo hogar en Bariloche
          </h1>
          <p class="mt-2 text-base md:text-lg text-white/90 max-w-2xl">
            Acompañamiento de punta a punta.
          </p>

          <div class="mt-6 flex flex-wrap gap-3">
            <a
              href="#propiedades"
              class="rounded-lg bg-[color:var(--brand-primary)] text-white px-5 py-2.5 text-sm md:text-base hover:opacity-90 transition"
              >Ver propiedades</a
            >
          </div>
        </div>
      </section>

      <!-- Panel de búsqueda (simple) -->
      <div class="mx-auto container-max px-4 -mt-14 relative z-10">
        <form class="rounded-xl border border-neutral-200 bg-white p-4 md:p-5 shadow-sm">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Operación</label>
              <select class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                <option>Venta</option>
                <option>Alquiler</option>
              </select>
            </div>
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Tipo</label>
              <select class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                <option>Casa</option>
                <option>Departamento</option>
                <option>Lote</option>
                <option>Local</option>
              </select>
            </div>
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Barrio/Zona</label>
              <input class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Ej. Centro" />
            </div>
            <div class="flex items-end">
              <button
                type="button"
                class="w-full md:w-auto h-10 rounded-lg bg-[color:var(--brand-primary)] text-white px-4 hover:opacity-90 transition"
              >
                Buscar
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Propiedades (desde CSV) -->
      <section id="propiedades" class="mx-auto container-max px-4 pt-16">
        <div>
          <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Selección</p>
          <h2 class="text-2xl md:text-3xl font-medium tracking-tight">PROPIEDADES</h2>
        </div>

        <!-- Grilla destino (se llena por JS con datos del CSV) -->
        <div id="props-grid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <!-- Mensaje vacío -->
        <div id="props-empty" class="hidden mt-6 rounded-xl border border-neutral-200 bg-white p-6 text-center">
          <p class="font-medium text-neutral-900">No hay propiedades para mostrar</p>
          <p class="text-neutral-600 text-sm">Verificá el enlace de CSV o agregá filas en tu hoja.</p>
        </div>
      </section>

      <!-- Tasación / Escribime -->
      <section id="tasacion" class="mx-auto container-max px-4 pt-20">
        <div>
          <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Tu propiedad</p>
          <h2 class="text-2xl md:text-3xl font-medium tracking-tight">Escribime</h2>
        </div>
        <p class="mt-2 text-neutral-700">
          Completá tus datos y el motivo de tu consulta; me contactaré muy pronto.
        </p>

        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-8">
          <form id="contact-form" class="rounded-xl border border-neutral-200 p-4 md:p-6 bg-white">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="flex flex-col">
                <label for="nombre" class="text-xs text-neutral-600 mb-1">Nombre</label>
                <input id="nombre" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Tu nombre" />
              </div>
              <div class="flex flex-col">
                <label for="email" class="text-xs text-neutral-600 mb-1">Email</label>
                <input id="email" type="email" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="tucorreo@mail.com" />
              </div>
              <div class="flex flex-col">
                <label for="telefono" class="text-xs text-neutral-600 mb-1">Teléfono</label>
                <input id="telefono" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="+54 9 ..." />
              </div>
              <div class="flex flex-col">
                <label for="tipo" class="text-xs text-neutral-600 mb-1">Tipo de propiedad</label>
                <select id="tipo" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="Casa">Casa</option>
                  <option value="Departamento">Departamento</option>
                  <option value="Lote">Lote</option>
                  <option value="Local">Local</option>
                </select>
              </div>
              <div class="flex flex-col">
                <label for="operacion" class="text-xs text-neutral-600 mb-1">Operación</label>
                <select id="operacion" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="Venta">Venta</option>
                  <option value="Alquiler">Alquiler</option>
                </select>
              </div>
              <div class="flex flex-col md:col-span-2">
                <label for="direccion" class="text-xs text-neutral-600 mb-1">Dirección</label>
                <input id="direccion" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Calle, número, barrio" />
              </div>
              <div class="flex flex-col md:col-span-2">
                <label for="mensaje" class="text-xs text-neutral-600 mb-1">Mensaje</label>
                <textarea id="mensaje" rows="4" class="rounded-lg border border-neutral-300 px-3 py-2 bg-white" placeholder="Detalles relevantes o el tema por el que querés consultar"></textarea>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-between gap-3">
              <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-[color:var(--brand-primary)] text-white h-10 px-4 hover:opacity-90 transition">Enviar</button>
              <span id="form-ok" class="text-sm text-green-700 hidden">¡Gracias! Me contactaré a la brevedad.</span>
            </div>
          </form>

          <div class="rounded-xl overflow-hidden border border-neutral-200 bg-neutral-50">
            <img
              src="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/c4bf838c-8b53-4947-a908-295e7052c60c.jpg"
              alt="Bariloche"
              class="object-cover h-full w-full"
            />
          </div>
        </div>
      </section>

      <!-- Contacto -->
      <section id="contacto" class="mx-auto container-max px-4 pt-20 pb-24">
        <div class="w-full rounded-xl border border-neutral-200 bg-white p-6 break-words">
          <div>
            <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Contacto</p>
            <h2 class="text-2xl md:text-3xl font-medium tracking-tight">Hablemos</h2>
          </div>

          <div class="mt-4 space-y-2 text-sm md:text-base">
            <p class="text-neutral-700">
              Email
              <a
                href="mailto:nataliagonzalezmartillerapublica@ngespacios.com.ar"
                class="no-underline text-[color:var(--brand-primary)] hover:opacity-90 ml-1 break-all inline-block max-w-full align-baseline"
              >
                nataliagonzalezmartillerapublica@ngespacios.com.ar
              </a>
            </p>
            <p class="text-neutral-700">
              WhatsApp
              <a
                href="https://wa.me/5492944635083"
                target="_blank"
                rel="noreferrer"
                class="no-underline text-[color:var(--brand-primary)] hover:opacity-90 ml-1 break-all inline-block"
              >
                +54 9 294 463 5083
              </a>
            </p>
            <p class="text-neutral-700">San Carlos de Bariloche, Río Negro, Argentina</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-neutral-200 mt-8">
      <div class="mx-auto container-max px-4 h-16 flex items-center justify-between text-sm">
        <p class="text-neutral-700">© <span id="year"></span> <span class="font-medium">NGespacios — Natalia González</span></p>
        <p class="text-neutral-700">Hecho con ♥ en Bariloche</p>
      </div>
    </footer>

    <!-- WhatsApp Floating -->
    <a
      href="https://wa.me/5492944635083"
      target="_blank"
      rel="noreferrer"
      class="fixed bottom-4 right-4 z-40 inline-flex items-center gap-2 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 transition"
      aria-label="Contactar por WhatsApp"
    >
      <i data-lucide="message-circle" class="h-5 w-5"></i>
      WhatsApp
    </a>

    <!-- Modal Galería con Carrusel + Ficha -->
    <div id="gallery-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="gallery-title">
      <div class="absolute inset-0 bg-black/75 backdrop-blur-sm"></div>

      <div class="relative h-full w-full flex items-center justify-center px-4">
        <!-- Controles superiores -->
        <div class="absolute top-3 right-3 flex items-center gap-2 z-50">
          <a
            id="gallery-wa"
            href="#"
            target="_blank"
            rel="noreferrer"
            class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-green-600 text-white hover:bg-green-700 transition"
            title="WhatsApp"
            aria-label="Abrir WhatsApp"
          >
            <i data-lucide="message-circle" class="h-4 w-4"></i>
          </a>
          <button
            id="gallery-ficha-btn"
            type="button"
            class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-[color:var(--brand-primary)] border border-white hover:bg-white transition"
            title="Ficha"
            aria-label="Ver ficha"
          >
            <i data-lucide="file-text" class="h-4 w-4"></i>
          </button>
          <button
            id="gallery-close"
            type="button"
            class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition"
            aria-label="Cerrar"
            title="Cerrar"
          >
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>

        <!-- Flechas -->
        <button
          id="gallery-prev"
          type="button"
          class="absolute left-3 md:left-6 top-1/2 -translate-y-1/2 inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition z-40"
          aria-label="Anterior"
          title="Anterior"
        >
          <i data-lucide="chevron-left" class="h-4 w-4"></i>
        </button>
        <button
          id="gallery-next"
          type="button"
          class="absolute right-3 md:right-6 top-1/2 -translate-y-1/2 inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition z-40"
          aria-label="Siguiente"
          title="Siguiente"
        >
          <i data-lucide="chevron-right" class="h-4 w-4"></i>
        </button>

        <!-- Imagen -->
        <figure class="relative w-full max-w-5xl aspect-[16/10] md:aspect-[16/9] lg:aspect-[21/9]">
          <img id="gallery-img" src="" alt="" class="object-contain w-full h-full select-none" />
          <figcaption id="gallery-counter" class="absolute bottom-3 left-1/2 -translate-x-1/2 text-xs text-white/90 bg-black/40 px-2 py-1 rounded-md"></figcaption>
        </figure>

        <!-- Ficha compacta -->
        <div id="gallery-info" class="hidden absolute left-1/2 -translate-x-1/2 bottom-4 w-[95%] max-w-2xl rounded-lg border border-neutral-200 bg-white/95 backdrop-blur p-3 md:p-4 shadow-lg z-40">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 id="gallery-title" class="text-sm md:text-base font-medium tracking-tight"></h3>
              <p id="gallery-sub" class="text-xs text-neutral-600 mt-0.5"></p>
              <div class="mt-2 inline-flex items-center gap-2">
                <span id="gallery-badge-op" class="text-[10px] rounded-md bg-neutral-100 px-2 py-1"></span>
                <span id="gallery-badge-type" class="text-[10px] rounded-md bg-[color:var(--brand-primary)] text-white px-2 py-1"></span>
              </div>
            </div>
            <div class="text-[color:var(--brand-primary)] text-sm md:text-base font-semibold shrink-0" id="gallery-price"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel Admin (sin botón, se abre con ?admin=1 y requiere PIN) -->
    <div id="admin-panel" class="hidden fixed inset-x-3 md:inset-x-auto md:right-6 md:left-auto md:w-[720px] top-6 z-[60]">
      <div class="rounded-xl bg-white border border-neutral-200 shadow-xl overflow-hidden">
        <!-- Header -->
        <div class="flex items-center justify-between h-12 px-4 border-b border-neutral-200">
          <div class="text-sm font-medium">Administración</div>
          <button id="admin-close" class="h-8 w-8 grid place-items-center rounded-md hover:bg-neutral-100" aria-label="Cerrar">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>

        <!-- Gate (PIN) -->
        <div id="admin-pin-view" class="p-4">
          <div class="flex items-center gap-2 text-sm text-neutral-700 mb-3">
            <span aria-hidden="true">🔒</span> Acceso de administración
          </div>
          <form id="admin-pin-form" class="flex flex-col md:flex-row md:items-center gap-3">
            <input
              id="admin-pin-input"
              type="password"
              inputmode="numeric"
              autocomplete="off"
              class="flex-1 rounded-lg border border-neutral-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500"
              placeholder="Ingresá tu PIN"
              aria-describedby="admin-pin-error"
            />
            <button
              id="admin-pin-submit"
              type="submit"
              class="inline-flex items-center gap-2 rounded-lg bg-sky-600 text-white px-3 py-2 text-sm font-medium hover:bg-sky-700"
            >
              Desbloquear
            </button>
          </form>
          <p id="admin-pin-error" class="mt-2 text-sm text-red-600 hidden"></p>
          <p id="admin-pin-hint" class="mt-2 text-xs text-neutral-500">
            5 intentos permitidos. Luego, bloqueo por 5 minutos.
          </p>
        </div>

        <!-- Panel (URL CSV) -->
        <div id="admin-csv-view" class="hidden p-4">
          <div class="flex flex-col md:flex-row md:items-end gap-3">
            <div class="flex-1">
              <label for="csv-url" class="text-xs text-neutral-600 mb-1 block">Fuente de datos (CSV público)</label>
              <input id="csv-url" type="url" class="w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500" placeholder="https://docs.google.com/spreadsheets/.../export?format=csv" />
              <p id="admin-csv-msg" class="mt-2 text-xs text-neutral-500">Publicá tu hoja como CSV en Google Sheets o compartila como “Cualquiera con el enlace: lector”.</p>
            </div>
            <div class="flex items-center gap-2">
              <button id="csv-test" class="inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-neutral-50">
                ⟳ Probar
              </button>
              <button id="csv-save" class="inline-flex items-center gap-2 rounded-lg bg-sky-600 text-white px-3 py-2 text-sm hover:bg-sky-700">
                ✔ Guardar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Montaje futuro React (no afecta) -->
    <div id="app" style="display: none"></div>

    <!-- JS: utilidades base, galería, datos CSV y admin -->
    <script>
      // Año en footer
      document.getElementById('year').textContent = new Date().getFullYear();

      // Lucide render
      const renderIcons = () => {
        if (window.lucide) window.lucide.createIcons();
      };
      window.addEventListener('DOMContentLoaded', renderIcons);

      // Scroll suave
      document.querySelectorAll('a[href^="#"]').forEach((a) => {
        a.addEventListener('click', (e) => {
          const href = a.getAttribute('href');
          if (!href || href === '#') return;
          const el = document.querySelector(href);
          if (el) {
            e.preventDefault();
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Menú móvil
      const btnMobile = document.getElementById('btn-mobile');
      const mobileMenu = document.getElementById('mobile-menu');
      const toggleMenu = (open) => {
        const willOpen = typeof open === 'boolean' ? open : mobileMenu.classList.contains('hidden');
        mobileMenu.classList.toggle('hidden', !willOpen);
        btnMobile?.setAttribute('aria-expanded', String(willOpen));
        if (window.lucide) {
          btnMobile.innerHTML = willOpen
            ? '<i data-lucide="x" class="h-4 w-4"></i>'
            : '<i data-lucide="menu" class="h-4 w-4"></i>';
          window.lucide.createIcons();
        }
      };
      btnMobile?.addEventListener('click', () => toggleMenu());
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') toggleMenu(false);
      });
      mobileMenu?.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => toggleMenu(false));
      });
      window.addEventListener('resize', () => {
        if (window.innerWidth >= 768) toggleMenu(false);
      });

      // Simulación submit del formulario
      const form = document.getElementById('contact-form');
      const ok = document.getElementById('form-ok');
      form?.addEventListener('submit', (e) => {
        e.preventDefault();
        ok?.classList.remove('hidden');
        setTimeout(() => {
          form.reset();
        }, 200);
      });
    </script>

    <script>
      /**
       * @section Galería con carrusel + Ficha
       * Maneja apertura desde cards con data-images y botones:
       *  - [data-action="open-gallery"]
       *  - [data-action="open-gallery-ficha"] (muestra ficha compacta)
       */

      // Estado galería
      const galleryState = {
        images: [],
        index: 0,
        meta: { title: '', operation: '', type: '', location: '', price: '' },
        infoOpen: false,
      };

      // Elementos
      const modal = document.getElementById('gallery-modal');
      const imgEl = document.getElementById('gallery-img');
      const counterEl = document.getElementById('gallery-counter');
      const closeBtn = document.getElementById('gallery-close');
      const prevBtn = document.getElementById('gallery-prev');
      const nextBtn = document.getElementById('gallery-next');
      const fichaBtn = document.getElementById('gallery-ficha-btn');
      const infoPanel = document.getElementById('gallery-info');
      const waBtn = document.getElementById('gallery-wa');

      const titleEl = document.getElementById('gallery-title');
      const subEl = document.getElementById('gallery-sub');
      const priceEl = document.getElementById('gallery-price');
      const badgeOp = document.getElementById('gallery-badge-op');
      const badgeType = document.getElementById('gallery-badge-type');

      /** Genera link de WhatsApp */
      function buildWaLink(meta) {
        const WA_PHONE = '5492944635083';
        const { title, operation, type, location, price } = meta || {};
        const msg = `Hola Natalia, me interesa la propiedad "${title}" (${operation} - ${type}) en ${location}. Precio: ${price}. ¿Podemos coordinar una visita? Gracias.`;
        return `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(msg)}`;
      }

      /** Actualiza la UI del modal */
      function updateGalleryUI() {
        if (!galleryState.images.length) return;
        imgEl.src = galleryState.images[galleryState.index];
        imgEl.alt = galleryState.meta.title || 'Imagen de propiedad';
        counterEl.textContent =
          String(galleryState.index + 1) + ' / ' + String(galleryState.images.length);

        titleEl.textContent = galleryState.meta.title;
        subEl.textContent = galleryState.meta.location;
        priceEl.textContent = galleryState.meta.price;
        badgeOp.textContent = galleryState.meta.operation;
        badgeType.textContent = galleryState.meta.type;

        waBtn.href = buildWaLink(galleryState.meta);

        // Re-render de íconos
        if (window.lucide) window.lucide.createIcons();
      }

      /** Abre la galería */
      function openGallery({ images, meta, startIndex = 0, openFicha = false }) {
        galleryState.images = images || [];
        galleryState.index = Math.max(0, Math.min(startIndex, galleryState.images.length - 1));
        galleryState.meta = meta || {};
        galleryState.infoOpen = !!openFicha;

        infoPanel.classList.toggle('hidden', !galleryState.infoOpen);
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        updateGalleryUI();
      }

      /** Cierra la galería */
      function closeGallery() {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
      }

      /** Navegación */
      function prevImage() {
        if (!galleryState.images.length) return;
        galleryState.index =
          (galleryState.index - 1 + galleryState.images.length) % galleryState.images.length;
        updateGalleryUI();
      }
      function nextImage() {
        if (!galleryState.images.length) return;
        galleryState.index = (galleryState.index + 1) % galleryState.images.length;
        updateGalleryUI();
      }

      /** Toggle ficha compacta */
      function toggleFicha() {
        galleryState.infoOpen = !galleryState.infoOpen;
        infoPanel.classList.toggle('hidden', !galleryState.infoOpen);
      }

      // Eventos globales del modal
      closeBtn.addEventListener('click', closeGallery);
      prevBtn.addEventListener('click', prevImage);
      nextBtn.addEventListener('click', nextImage);
      fichaBtn.addEventListener('click', toggleFicha);

      modal.addEventListener('click', (e) => {
        const isBackdrop = e.target === modal || e.target === modal.firstElementChild;
        if (isBackdrop) closeGallery();
      });

      document.addEventListener('keydown', (e) => {
        if (modal.classList.contains('hidden')) return;
        if (e.key === 'Escape') closeGallery();
        if (e.key === 'ArrowLeft') prevImage();
        if (e.key === 'ArrowRight') nextImage();
      });

      /** Normaliza string de galería separada por | , ; o saltos de línea */
      function parseImages(str) {
        return String(str || '')
          .split(/\s*[\|\n;,]\s*/g)
          .map((s) => s.trim())
          .filter(Boolean);
      }

      /** Obtiene metadatos desde el article */
      function getCardMeta(card) {
        return {
          title: card.getAttribute('data-title') || '',
          operation: card.getAttribute('data-operation') || '',
          type: card.getAttribute('data-type') || '',
          location: card.getAttribute('data-location') || '',
          price: card.getAttribute('data-price') || '',
        };
      }

      /**
       * Enlaza disparadores de galería dentro de un contenedor dado
       * @param {Element} container
       */
      function bindGalleryIn(container) {
        if (!container) return;
        const cards = container.querySelectorAll('article[data-images]');
        cards.forEach((card) => {
          // Evitar doble-bind
          if (card.__ngBound) return;
          card.__ngBound = true;

          const meta = getCardMeta(card);
          const images = parseImages(card.getAttribute('data-images'));

          // Abrir galería
          card.querySelectorAll('[data-action="open-gallery"]').forEach((btn) => {
            btn.addEventListener('click', () =>
              openGallery({ images, meta, startIndex: 0, openFicha: false }),
            );
          });

          // Abrir con ficha
          card.querySelectorAll('[data-action="open-gallery-ficha"]').forEach((btn) => {
            btn.addEventListener('click', () =>
              openGallery({ images, meta, startIndex: 0, openFicha: true }),
            );
          });
        });
      }

      // Exponer para usar desde el render
      window.NG_bindGalleryIn = bindGalleryIn;
    </script>

    <script>
      /**
       * @section Carga CSV + render de cards en la sección principal
       * - Sin botón Admin visible.
       * - Panel Admin con PIN (Valda2412) solo accesible con ?admin=1.
       * - Tras Probar/Guardar: se desloguea (se requiere PIN de nuevo).
       */

      // Constantes / storage keys
      const CSV_DEFAULT =
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vRE45mae2W4RPiAVFq7Jl8E0WeD7XXoPxXDT6oGKXFPxAACcGVC30Bq-FUcbM90iIn5H-5ddOr9hl1K/pub?output=csv';
      const LS_KEY = 'ngespacios:csvUrl';
      const PIN_VALUE = 'Valda2412';

      // PIN intents/lock (sessionStorage)
      const FAILS_KEY = 'ngespacios:pinFails';
      const LOCK_UNTIL_KEY = 'ngespacios:pinLockUntil';
      function getFails() {
        try {
          return Number(sessionStorage.getItem(FAILS_KEY)) || 0;
        } catch {
          return 0;
        }
      }
      function setFails(n) {
        try {
          sessionStorage.setItem(FAILS_KEY, String(Math.max(0, n)));
        } catch {}
      }
      function clearFails() {
        try {
          sessionStorage.removeItem(FAILS_KEY);
        } catch {}
      }
      function getLockUntil() {
        try {
          return Number(sessionStorage.getItem(LOCK_UNTIL_KEY)) || 0;
        } catch {
          return 0;
        }
      }
      function setLockMs(ms) {
        try {
          sessionStorage.setItem(LOCK_UNTIL_KEY, String(Date.now() + Math.max(0, ms)));
        } catch {}
      }
      function clearLock() {
        try {
          sessionStorage.removeItem(LOCK_UNTIL_KEY);
        } catch {}
      }

      // Helpers CSV
      /** Normaliza Google Sheets a CSV */
      function normalizeSheetUrlToCsv(url) {
        try {
          const u = new URL(url);
          if (u.hostname.includes('docs.google.com')) {
            if (u.pathname.endsWith('/pub')) {
              u.searchParams.set('output', 'csv');
              return u.toString();
            }
            if (u.pathname.includes('/export')) {
              u.searchParams.set('format', 'csv');
              return u.toString();
            }
          }
          return url;
        } catch {
          return url;
        }
      }

      /** Parser CSV robusto con comillas */
      function parseCSV(text) {
        const rows = [];
        let cur = '',
          row = [],
          inQ = false;
        const s = String(text || '');
        for (let i = 0; i < s.length; i++) {
          const c = s[i];
          const n = s[i + 1];
          if (c === '"') {
            if (inQ && n === '"') {
              cur += '"';
              i++;
            } else {
              inQ = !inQ;
            }
          } else if ((c === ',' || c === ';') && !inQ) {
            row.push(cur);
            cur = '';
          } else if ((c === '\n' || c === '\r') && !inQ) {
            if (c === '\r' && n === '\n') i++;
            row.push(cur);
            rows.push(row);
            row = [];
            cur = '';
          } else {
            cur += c;
          }
        }
        if (cur.length || row.length) {
          row.push(cur);
          rows.push(row);
        }
        if (!rows.length) return [];
        const headers = rows[0].map((h) => (h || '').trim());
        return rows
          .slice(1)
          .filter((r) => r.some((v) => v && String(v).trim() !== ''))
          .map((r) => {
            const o = {};
            headers.forEach((h, idx) => {
              o[h] = (r[idx] ?? '').trim();
            });
            return o;
          });
      }

      /** Asegura primer imagen */
      function firstImageFrom(p) {
        const field =
          p.images || p.imagen || p.image || p.gallery || p.galeria || p['galería'] || '';
        const imgs = String(field || '')
          .split(/\s*[\|\n;,]\s*/g)
          .map((x) => x.trim())
          .filter(Boolean);
        return imgs[0] || 'https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/21efe696-7b88-478a-98f2-46b3ac999d0d.jpg';
      }

      /** Formatea precio (prioriza price_label, luego amount+currency+period o price) */
      function formatPrice(p) {
        const label =
          p.price_label || p['price label'] || p.precio || p.Price || p.price || p.Precio || '';
        if (label && String(label).trim()) return String(label).trim();
        const amount = p.price_amount || p.monto || '';
        const curr = p.price_currency || p.moneda || '';
        const period = p.price_period || p.periodo || '';
        let txt = '';
        if (curr && amount) txt = `${String(curr).toUpperCase()} ${amount}`;
        else if (amount) txt = String(amount);
        if (period) txt += ` ${period}`;
        return txt || 'Consultar';
      }

      /** Crea una card con el mismo look de “destacadas” y data-* para galería */
      function createCardFromRow(row) {
        const id = row.id || row.ID || row.Id || '';
        const title =
          row.title || row.titulo || row.Título || row.Titulo || row.Propiedad || 'Sin título';
        const operation = row.operation || row.operacion || row.Operación || row.Operacion || '';
        const type = row.type || row.tipo || row.Tipo || '';
        const location =
          row.location || row.ubicacion || row.Ubicación || row.Localidad || row.Location || '';
        const status = row.status || row.Estado || '';
        const price = formatPrice(row);

        // Imágenes
        const imagesField =
          row.images || row.gallery || row.galeria || row['galería'] || row.imagen || '';
        const images = String(imagesField || '')
          .split(/\s*[\|\n;,]\s*/g)
          .map((x) => x.trim())
          .filter(Boolean);
        const cover = images[0] || firstImageFrom(row);

        // PDF Ficha (si lo hay)
        const pdfUrl = row.pdf_url || row.ficha_pdf || row.pdf || '';

        // Datos adicionales
        const bedrooms = row.bedrooms || row.habitaciones || row.habs || '';
        const bathrooms = row.bathrooms || row.baños || row.banos || '';
        const garages = row.garages || row.cochera || row.cocheras || '';
        const areaM2 = row.area_m2 || row.m2 || row.superficie || '';
        const lotM2 = row.lot_m2 || row.lote_m2 || '';

        // WhatsApp phone (si no, usamos el general)
        const waPhone = (row.whatsapp_phone || '').replace(/[^\d]/g, '') || '5492944635083';
        const waMsg = `Hola Natalia, me interesa la propiedad "${title}" (${operation} - ${type}) en ${location}. Precio: ${price}. ¿Podemos coordinar una visita? Gracias.`;
        const waLink = `https://wa.me/${waPhone}?text=${encodeURIComponent(waMsg)}`;

        // Article
        const card = document.createElement('article');
        card.className =
          'group rounded-xl border border-neutral-200 overflow-hidden bg-white shadow-sm hover:shadow-md transition';
        card.setAttribute('data-id', id);
        card.setAttribute('data-title', title);
        card.setAttribute('data-operation', operation);
        card.setAttribute('data-type', type);
        card.setAttribute('data-location', location);
        card.setAttribute('data-price', price);
        card.setAttribute('data-images', images.join('|'));

        // Img header
        const head = document.createElement('div');
        head.className = 'relative h-48 w-full overflow-hidden';
        const headBtn = document.createElement('button');
        headBtn.type = 'button';
        headBtn.className = 'absolute inset-0 z-10';
        headBtn.setAttribute('aria-label', 'Abrir galería');
        headBtn.setAttribute('data-action', 'open-gallery');
        head.appendChild(headBtn);

        const img = document.createElement('img');
        img.src = cover;
        img.alt = title;
        img.className = 'object-cover h-full w-full';
        head.appendChild(img);

        const badgesTop = document.createElement('div');
        badgesTop.className = 'absolute top-3 left-3 flex gap-2';
        const bOp = document.createElement('span');
        bOp.className = 'rounded-md bg-white/90 px-2 py-1 text-xs font-medium';
        bOp.textContent = operation;
        const bType = document.createElement('span');
        bType.className = 'rounded-md bg-[color:var(--brand-primary)] text-white px-2 py-1 text-xs font-medium';
        bType.textContent = type;
        badgesTop.appendChild(bOp);
        badgesTop.appendChild(bType);
        head.appendChild(badgesTop);
        card.appendChild(head);

        // Body
        const body = document.createElement('div');
        body.className = 'p-4';

        const h3 = document.createElement('h3');
        h3.className = 'font-medium tracking-tight line-clamp-1';
        h3.textContent = title;
        body.appendChild(h3);

        const locRow = document.createElement('div');
        locRow.className = 'mt-1 flex items-center gap-1 text-sm text-neutral-600';
        const locIcon = document.createElement('i');
        locIcon.setAttribute('data-lucide', 'map-pin');
        locIcon.className = 'h-4 w-4';
        const locSpan = document.createElement('span');
        locSpan.className = 'line-clamp-1';
        locSpan.textContent = location;
        locRow.appendChild(locIcon);
        locRow.appendChild(locSpan);
        body.appendChild(locRow);

        // Specs
        const specs = document.createElement('ul');
        specs.className = 'mt-3 flex flex-wrap gap-x-3 gap-y-2 text-xs text-neutral-700';
        if (String(bedrooms).trim()) {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML =
            '<i data-lucide="bed" class="h-4 w-4 text-neutral-600"></i><span>' +
            String(bedrooms) +
            ' hab</span>';
          specs.appendChild(li);
        }
        if (String(bathrooms).trim()) {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML =
            '<i data-lucide="bath" class="h-4 w-4 text-neutral-600"></i><span>' +
            String(bathrooms) +
            ' baños</span>';
          specs.appendChild(li);
        }
        if (String(garages).trim()) {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML =
            '<i data-lucide="car" class="h-4 w-4 text-neutral-600"></i><span>' +
            String(garages) +
            ' coch</span>';
          specs.appendChild(li);
        }
        if (String(areaM2).trim()) {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML =
            '<i data-lucide="square" class="h-4 w-4 text-neutral-600"></i><span>' +
            String(areaM2) +
            ' m² cub.</span>';
          specs.appendChild(li);
        }
        if (String(lotM2).trim()) {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML =
            '<i data-lucide="ruler" class="h-4 w-4 text-neutral-600"></i><span>' +
            String(lotM2) +
            ' m² lote</span>';
          specs.appendChild(li);
        }
        if (String(status).trim()) {
          const li = document.createElement('li');
          li.className =
            'inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-50 text-amber-700 border border-amber-100';
          li.textContent = String(status);
          specs.appendChild(li);
        }
        body.appendChild(specs);

        // Footer actions
        const bottom = document.createElement('div');
        bottom.className = 'mt-3 flex items-center justify-between';

        const priceEl = document.createElement('span');
        priceEl.className = 'text-lg font-semibold text-[color:var(--brand-primary)]';
        priceEl.textContent = price;
        bottom.appendChild(priceEl);

        const actions = document.createElement('div');
        actions.className = 'flex gap-2';

        const waA = document.createElement('a');
        waA.href = waLink;
        waA.target = '_blank';
        waA.rel = 'noreferrer';
        waA.className =
          'text-sm rounded-md bg-[color:var(--brand-primary)] text-white px-3 py-1.5 hover:opacity-90 transition';
        waA.textContent = 'WhatsApp';
        actions.appendChild(waA);

        if (pdfUrl && String(pdfUrl).trim()) {
          // Si hay PDF, “Ficha” descarga/abre PDF
          const pdfA = document.createElement('a');
          pdfA.href = String(pdfUrl).trim();
          pdfA.target = '_blank';
          pdfA.rel = 'noreferrer';
          pdfA.download = '';
          pdfA.className =
            'text-sm rounded-md border border-[color:var(--brand-primary)] text-[color:var(--brand-primary)] px-3 py-1.5 hover:bg-[color:var(--brand-primary)] hover:text-white transition';
          pdfA.textContent = 'Ficha';
          actions.appendChild(pdfA);
        } else {
          // Sin PDF: abre ficha compacta de la galería
          const fichaBtn = document.createElement('button');
          fichaBtn.type = 'button';
          fichaBtn.setAttribute('data-action', 'open-gallery-ficha');
          fichaBtn.className =
            'text-sm rounded-md border border-[color:var(--brand-primary)] text-[color:var(--brand-primary)] px-3 py-1.5 hover:bg-[color:var(--brand-primary)] hover:text-white transition';
          fichaBtn.textContent = 'Ficha';
          actions.appendChild(fichaBtn);
        }

        bottom.appendChild(actions);
        body.appendChild(bottom);

        card.appendChild(body);

        return card;
      }

      // Render en grilla
      const grid = document.getElementById('props-grid');
      const emptyMsg = document.getElementById('props-empty');

      function renderList(rows) {
        grid.innerHTML = '';
        if (!rows || !rows.length) {
          emptyMsg.classList.remove('hidden');
          return;
        }
        emptyMsg.classList.add('hidden');
        rows.forEach((r) => {
          const card = createCardFromRow(r);
          grid.appendChild(card);
        });
        // Íconos y binds para galería en lo recién agregado
        if (window.lucide) window.lucide.createIcons();
        if (window.NG_bindGalleryIn) window.NG_bindGalleryIn(grid);
      }

      // Fetch CSV y render
      async function loadFrom(url) {
        try {
          const normalized = normalizeSheetUrlToCsv(url);
          const res = await fetch(normalized, { cache: 'no-store' });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const text = await res.text();
          const rows = parseCSV(text);
          // Filtrar filas válidas (con id y título)
          const data = rows.filter((r) => (r.id || r.title || r.titulo || r.Título || '').trim());
          renderList(data);
          return true;
        } catch (e) {
          console.error(e);
          renderList([]);
          return false;
        }
      }

      // Carga inicial (saved o default)
      (async function initialLoad() {
        try {
          const saved = localStorage.getItem(LS_KEY);
          const startUrl = saved || CSV_DEFAULT;
          document.getElementById('csv-url')?.setAttribute('value', startUrl);
          await loadFrom(startUrl);
        } catch (e) {
          console.warn('Inicialización:', e);
        }
      })();

      // ========================
      // Admin (PIN + CSV panel)
      // ========================
      const adminPanel = document.getElementById('admin-panel');
      const adminClose = document.getElementById('admin-close');

      const pinView = document.getElementById('admin-pin-view');
      const pinForm = document.getElementById('admin-pin-form');
      const pinInput = document.getElementById('admin-pin-input');
      const pinErr = document.getElementById('admin-pin-error');
      const pinHint = document.getElementById('admin-pin-hint');

      const csvView = document.getElementById('admin-csv-view');
      const csvInput = document.getElementById('csv-url');
      const csvMsg = document.getElementById('admin-csv-msg');
      const btnTest = document.getElementById('csv-test');
      const btnSave = document.getElementById('csv-save');

      function isLocked() {
        return getLockUntil() > Date.now();
      }
      function remainingText() {
        const diff = Math.max(0, getLockUntil() - Date.now());
        const sec = Math.ceil(diff / 1000);
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${m}:${String(s).padStart(2, '0')}`;
      }

      function showPin() {
        pinView.classList.remove('hidden');
        csvView.classList.add('hidden');
        pinErr.classList.add('hidden');
        if (isLocked()) {
          pinInput.disabled = true;
          pinHint.textContent = `Demasiados intentos. Bloqueado ${remainingText()}.`;
        } else {
          pinInput.disabled = false;
          pinHint.textContent = '5 intentos permitidos. Luego, bloqueo por 5 minutos.';
        }
        pinInput.focus();
      }
      function showCsv() {
        pinView.classList.add('hidden');
        csvView.classList.remove('hidden');
        csvInput.focus();
      }

      // Abrir solo si ?admin=1
      (function checkAdminOpen() {
        try {
          const u = new URL(window.location.href);
          if (u.searchParams.get('admin') === '1') {
            adminPanel.classList.remove('hidden');
            showPin();
          }
        } catch {}
      })();

      adminClose.addEventListener('click', () => {
        adminPanel.classList.add('hidden');
      });

      // Verificación PIN
      pinForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (isLocked()) {
          pinErr.textContent = `Demasiados intentos. Esperá ${remainingText()}.`;
          pinErr.classList.remove('hidden');
          return;
        }
        const value = String(pinInput.value || '').trim();
        if (value === PIN_VALUE) {
          // Éxito: limpiar contadores y pasar a CSV
          clearFails();
          clearLock();
          pinErr.classList.add('hidden');
          showCsv();
        } else {
          const cur = getFails() + 1;
          setFails(cur);
          if (cur >= 5) {
            setLockMs(5 * 60 * 1000);
            pinErr.textContent = 'Demasiados intentos. Bloqueado por 5 minutos.';
          } else {
            pinErr.textContent = `PIN incorrecto. Intento ${cur}/5.`;
          }
          pinErr.classList.remove('hidden');
          pinInput.value = '';
          pinInput.focus();
        }
      });

      // Probar / Guardar CSV
      async function handleAfterLoad(ok) {
        if (ok) {
          csvMsg.textContent = 'Datos cargados. Cerrando sesión de admin…';
          // Deslogueo inmediato
          clearFails();
          setLockMs(1); // fuerza a revalidar (1ms)
          // Ocultar panel
          setTimeout(() => {
            adminPanel.classList.add('hidden');
          }, 300);
        } else {
          csvMsg.textContent = 'No se pudo cargar el CSV. Revisá enlace o permisos.';
        }
      }

      btnTest.addEventListener('click', async () => {
        const url = String(csvInput.value || '').trim();
        if (!url) {
          csvMsg.textContent = 'Pegá una URL de Google Sheets (CSV).';
          return;
        }
        const ok = await loadFrom(url);
        await handleAfterLoad(ok);
      });

      btnSave.addEventListener('click', async () => {
        const url = String(csvInput.value || '').trim();
        if (!url) {
          csvMsg.textContent = 'Pegá una URL de Google Sheets (CSV).';
          return;
        }
        localStorage.setItem(LS_KEY, url);
        const ok = await loadFrom(url);
        await handleAfterLoad(ok);
      });
    </script>
  </body>
</html>
