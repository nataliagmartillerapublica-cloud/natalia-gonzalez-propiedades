<!--
  index.html
  NGespacios — Landing estática con:
  - Logo inline (NG + ESPACIOS a la derecha)
  - Listado de propiedades desde Google Sheets (CSV público)
  - Acceso Admin oculto: 5 toques/clicks rápidos sobre el logo → pide clave → abre panel
  - Modal de galería con ficha compacta
  - Vista “Ficha” pantalla completa con descripción
  - Botón “Descargar ficha” (usa Imprimir → Guardar como PDF)
-->

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>NGespacios — Inmobiliaria en Bariloche</title>
    <meta
      name="description"
      content="NGespacios — Tu próximo hogar en Bariloche. Venta, alquiler, tasaciones y acompañamiento personalizado."
    />

    <!-- Open Graph -->
    <meta property="og:title" content="NGespacios — Inmobiliaria en Bariloche" />
    <meta
      property="og:description"
      content="Venta, alquiler, tasaciones y acompañamiento personalizado en Bariloche."
    />
    <meta
      property="og:image"
      content="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/a1e13e5a-7034-4d9c-8295-9a73d6f21947.jpg"
    />

    <!-- Montserrat + Tailwind + Lucide -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marca y utilidades -->
    <style>
      :root {
        --brand-bg: #f4f2f2;
        --brand-primary: #572d30;
        --brand-text: #363332;
      }
      html, body { height: 100%; }
      body {
        font-family: 'Montserrat', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
        color: var(--brand-text);
        background: var(--brand-bg);
        font-weight: 300;
        letter-spacing: 0.01em;
      }
      a:focus-visible, button:focus-visible, select:focus-visible, input:focus-visible, textarea:focus-visible {
        outline: 2px solid var(--brand-primary);
        outline-offset: 2px;
        border-radius: 6px;
      }
      .container-max { max-width: 72rem; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      /* Admin UI */
      #ng-admin-panel .ng-card {
        background: #fff; border: 1px solid #e5e7eb; border-radius: 12px;
        box-shadow: 0 1px 2px rgba(16,24,40,0.04); padding: 14px;
      }
      #ng-admin-panel .ng-btn {
        display: inline-flex; align-items: center; gap: 8px; border-radius: 10px;
        padding: 8px 12px; font-size: 14px; border: 1px solid #d1d5db; background: #fff; color: #374151;
      }
      #ng-admin-panel .ng-btn:hover { background: #f9fafb; }
      #ng-admin-panel .ng-btn-primary { border-color: #0ea5e9; background: #0284c7; color: #fff; }
      #ng-admin-panel .ng-btn-primary:hover { background: #0369a1; }
      #ng-admin-panel .ng-input {
        width: 100%; border: 1px solid #d1d5db; border-radius: 10px; padding: 10px 12px; font-size: 14px; outline: none;
      }
      #ng-admin-panel .ng-input:focus { border-color: #0ea5e9; box-shadow: 0 0 0 3px rgba(14,165,233,0.2); }
      #ng-admin-panel .ng-msg { font-size: 13px; }
      #ng-admin-panel .ng-msg.hint { color: #6b7280; }
      #ng-admin-panel .ng-msg.err { color: #b91c1c; }
    </style>
  </head>

  <body class="min-h-screen bg-[color:var(--brand-bg)] text-[color:var(--brand-text)]">
    <!-- Header -->
    <header class="sticky top-0 z-30 w-full border-b border-neutral-200 bg-[color:var(--brand-bg)]/90 backdrop-blur-md">
      <div class="mx-auto container-max px-4 h-16 flex items-center justify-between">
        <!-- Logo inline (NG + ESPACIOS a la derecha) -->
        <a id="logo" href="#" class="flex items-center gap-2 select-none" aria-label="NGespacios - Inicio">
          <div class="h-9 w-9 md:h-10 md:w-10 rounded-[8px] bg-[color:var(--brand-primary)] grid place-items-center shadow-sm shrink-0">
            <span class="text-[color:var(--brand-bg)] font-light tracking-tight text-[15px] md:text-[16px]">NG</span>
          </div>
          <span class="text-[11px] md:text-[12px] tracking-[0.22em] text-[color:var(--brand-text)] font-light uppercase">
            ESPACIOS
          </span>
        </a>

        <nav class="hidden md:flex items-center gap-6 text-sm">
          <a href="#propiedades" class="hover:text-[color:var(--brand-primary)]">Propiedades</a>
          <a href="#tasacion" class="hover:text-[color:var(--brand-primary)]">Tasación</a>
          <a href="#contacto" class="hover:text-[color:var(--brand-primary)]">Contacto</a>
          <a
            href="#propiedades"
            class="rounded-lg bg-[color:var(--brand-primary)] px-4 py-2 text-white hover:opacity-90 transition-colors"
          >
            Ver propiedades
          </a>
          <!-- Admin invisible; acceso secreto por taps en el logo -->
        </nav>

        <!-- Menú móvil -->
        <button
          id="btn-mobile"
          class="md:hidden inline-flex h-9 w-9 items-center justify-center rounded-md border border-neutral-300"
          aria-label="Abrir menú"
          aria-expanded="false"
          aria-controls="mobile-menu"
          type="button"
        >
          <i data-lucide="menu" class="h-4 w-4"></i>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden hidden border-t border-neutral-200 bg-[color:var(--brand-bg)]/95 backdrop-blur-md">
        <div class="mx-auto container-max px-4 py-3">
          <div class="grid gap-2 text-sm">
            <a href="#propiedades" class="py-2 hover:text-[color:var(--brand-primary)]">Propiedades</a>
            <a href="#tasacion" class="py-2 hover:text-[color:var(--brand-primary)]">Tasación</a>
            <a href="#contacto" class="py-2 hover:text-[color:var(--brand-primary)]">Contacto</a>
            <a
              href="#propiedades"
              class="mt-2 inline-flex w-full items-center justify-center rounded-lg bg-[color:var(--brand-primary)] px-4 py-2 text-white hover:opacity-90 transition-colors"
            >
              Ver propiedades
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Panel Admin (oculto SIEMPRE hasta pasar clave) -->
    <section
      id="ng-admin-panel"
      class="mx-auto container-max px-4 py-3 hidden"
      role="region"
      aria-label="Panel de administración"
    >
      <div class="ng-card">
        <div style="display:flex; flex-wrap:wrap; align-items:center; gap:12px;">
          <label for="ng-csv-url" class="ng-msg hint">Fuente (Google Sheets CSV público)</label>
          <input
            id="ng-csv-url"
            type="url"
            placeholder="https://docs.google.com/spreadsheets/.../export?format=csv"
            class="ng-input"
            style="flex:1 1 320px;"
          />
          <button id="ng-btn-test" class="ng-btn" title="Probar carga">⟳ Probar</button>
          <button id="ng-btn-save" class="ng-btn ng-btn-primary" title="Guardar en este navegador">✔ Guardar</button>
        </div>
        <p id="ng-admin-msg" class="ng-msg hint mt-2">
          Pegá la URL pública (CSV) de tu hoja. Ejemplo: “Archivo → Publicar en la web → CSV”.
        </p>
      </div>
    </section>

    <main>
      <!-- Hero -->
      <section class="relative isolate">
        <div class="absolute inset-0 -z-10">
          <img
            src="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/3dfc1722-9613-461d-8363-563a771d5f3d.jpg"
            alt="Lago en Bariloche"
            class="object-cover w-full h-full"
          />
          <div class="absolute inset-0 bg-[color:var(--brand-bg)] mix-blend-multiply opacity-30"></div>
          <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/45 to-black/30"></div>
        </div>

        <div class="mx-auto container-max px-4 py-16 md:py-24">
          <p class="text-[12px] sm:text-sm md:text-base text-white/90 font-light leading-snug">
            Natalia González • Martillera y Corredora Pública • MAT. Nº377- RP-21 Fº456 TºII
          </p>

          <h1 class="mt-3 text-3xl md:text-5xl font-medium tracking-tight text-white">
            Tu próximo hogar en Bariloche
          </h1>
          <p class="mt-2 text-base md:text-lg text-white/90 max-w-2xl">
            Acompañamiento de punta a punta.
          </p>

          <div class="mt-6 flex flex-wrap gap-3">
            <a
              href="#propiedades"
              class="rounded-lg bg-[color:var(--brand-primary)] text-white px-5 py-2.5 text-sm md:text-base hover:opacity-90 transition"
            >
              Ver propiedades
            </a>
          </div>
        </div>
      </section>

      <!-- Search Panel (simple) -->
      <div class="mx-auto container-max px-4 -mt-14 relative z-10">
        <form class="rounded-xl border border-neutral-200 bg-white p-4 md:p-5 shadow-sm">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Operación</label>
              <select class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                <option>Venta</option>
                <option>Alquiler</option>
              </select>
            </div>
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Tipo</label>
              <select class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                <option>Casa</option>
                <option>Departamento</option>
                <option>Lote</option>
                <option>Local</option>
              </select>
            </div>
            <div class="flex flex-col">
              <label class="text-xs text-neutral-600 mb-1">Barrio/Zona</label>
              <input class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Ej. Centro" />
            </div>
            <div class="flex items-end">
              <button
                type="button"
                class="w-full md:w-auto h-10 rounded-lg bg-[color:var(--brand-primary)] text-white px-4 hover:opacity-90 transition"
              >
                Buscar
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Propiedades -->
      <section id="propiedades" class="mx-auto container-max px-4 pt-16">
        <div>
          <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Selección</p>
          <h2 class="text-2xl md:text-3xl font-medium tracking-tight">Propiedades</h2>
        </div>

        <!-- Grilla renderizada desde CSV -->
        <div id="grid-propiedades" class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <!-- Placeholder vacío -->
        <div
          id="grid-empty"
          class="mt-6 rounded-xl border border-dashed border-neutral-300 p-8 text-center bg-white hidden"
        >
          <p class="text-neutral-700 font-medium mb-1">Sin propiedades por ahora</p>
          <p class="text-neutral-500 text-sm">Guardá tu URL CSV en “Admin” (tap secreto en el logo) y probá de nuevo.</p>
        </div>
      </section>

      <!-- Tasación / Escribime -->
      <section id="tasacion" class="mx-auto container-max px-4 pt-20">
        <div>
          <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Tu propiedad</p>
          <h2 class="text-2xl md:text-3xl font-medium tracking-tight">Escribime</h2>
        </div>
        <p class="mt-2 text-neutral-700">
          Completá tus datos y el motivo de tu consulta; me contactaré muy pronto.
        </p>

        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-8">
          <form id="contact-form" class="rounded-xl border border-neutral-200 p-4 md:p-6 bg-white">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="flex flex-col">
                <label for="nombre" class="text-xs text-neutral-600 mb-1">Nombre</label>
                <input id="nombre" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Tu nombre" />
              </div>

              <div class="flex flex-col">
                <label for="email" class="text-xs text-neutral-600 mb-1">Email</label>
                <input id="email" type="email" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="tucorreo@mail.com" />
              </div>

              <div class="flex flex-col">
                <label for="telefono" class="text-xs text-neutral-600 mb-1">Teléfono</label>
                <input id="telefono" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="+54 9 ..." />
              </div>

              <div class="flex flex-col">
                <label for="tipo" class="text-xs text-neutral-600 mb-1">Tipo de propiedad</label>
                <select id="tipo" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="Casa">Casa</option>
                  <option value="Departamento">Departamento</option>
                  <option value="Lote">Lote</option>
                  <option value="Local">Local</option>
                </select>
              </div>

              <div class="flex flex-col">
                <label for="operacion" class="text-xs text-neutral-600 mb-1">Operación</label>
                <select id="operacion" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white">
                  <option value="" disabled selected>Seleccionar</option>
                  <option value="Venta">Venta</option>
                  <option value="Alquiler">Alquiler</option>
                </select>
              </div>

              <div class="flex flex-col md:col-span-2">
                <label for="direccion" class="text-xs text-neutral-600 mb-1">Dirección</label>
                <input id="direccion" required class="h-10 rounded-lg border border-neutral-300 px-3 bg-white" placeholder="Calle, número, barrio" />
              </div>

              <div class="flex flex-col md:col-span-2">
                <label for="mensaje" class="text-xs text-neutral-600 mb-1">Mensaje</label>
                <textarea id="mensaje" rows="4" class="rounded-lg border border-neutral-300 px-3 py-2 bg-white" placeholder="Detalles relevantes o el tema por el que querés consultar"></textarea>
              </div>
            </div>

            <div class="mt-4 flex items-center justify-between gap-3">
              <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-[color:var(--brand-primary)] text-white h-10 px-4 hover:opacity-90 transition">
                Enviar
              </button>
              <span id="form-ok" class="text-sm text-green-700 hidden">¡Gracias! Me contactaré a la brevedad.</span>
            </div>
          </form>

          <div class="rounded-xl overflow-hidden border border-neutral-200 bg-neutral-50">
            <img
              src="https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/60bfcd2f-2017-4432-8ac5-8ca5102c7167.jpg"
              alt="Bariloche"
              class="object-cover h-full w-full"
            />
          </div>
        </div>
      </section>

      <!-- Contacto -->
      <section id="contacto" class="mx-auto container-max px-4 pt-20 pb-24">
        <div class="w-full rounded-xl border border-neutral-200 bg-white p-6 break-words">
          <div>
            <p class="text-xs uppercase tracking-[0.22em] text-[color:var(--brand-primary)]">Contacto</p>
            <h2 class="text-2xl md:text-3xl font-medium tracking-tight">Hablemos</h2>
          </div>

          <div class="mt-4 space-y-2 text-sm md:text-base">
            <p class="text-neutral-700">
              Email
              <a
                href="mailto:nataliagonzalezmartillerapublica@ngespacios.com.ar"
                class="no-underline text-[color:var(--brand-primary)] hover:opacity-90 ml-1 break-all inline-block max-w-full align-baseline text-xs sm:text-sm md:text-base"
              >
                nataliagonzalezmartillerapublica@ngespacios.com.ar
              </a>
            </p>
            <p class="text-neutral-700">
              WhatsApp
              <a
                href="https://wa.me/5492944635083"
                target="_blank"
                rel="noreferrer"
                class="no-underline text-[color:var(--brand-primary)] hover:opacity-90 ml-1 break-all inline-block max-w-full align-baseline"
              >
                +54 9 294 463 5083
              </a>
            </p>
            <p class="text-neutral-700">San Carlos de Bariloche, Río Negro, Argentina</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-neutral-200 mt-8">
      <div class="mx-auto container-max px-4 h-16 flex items-center justify-between text-sm">
        <p class="text-neutral-700">© <span id="year"></span> <span class="font-medium">NGespacios — Natalia González</span></p>
        <p class="text-neutral-700">Hecho con ♥ en Bariloche</p>
      </div>
    </footer>

    <!-- WhatsApp Floating -->
    <a
      href="https://wa.me/5492944635083"
      target="_blank"
      rel="noreferrer"
      class="fixed bottom-4 right-4 z-40 inline-flex items-center gap-2 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 transition"
      aria-label="Contactar por WhatsApp"
    >
      <i data-lucide="message-circle" class="h-5 w-5"></i>
      WhatsApp
    </a>

    <!-- Modal Galería con Carrusel + Ficha -->
    <div id="gallery-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="gallery-title">
      <div class="absolute inset-0 bg-black/75 backdrop-blur-sm"></div>

      <div class="relative h-full w-full flex items-center justify-center px-4">
        <!-- Controles superiores -->
        <div class="absolute top-3 right-3 flex items-center gap-2 z-50">
          <a
            id="gallery-wa"
            href="#"
            target="_blank"
            rel="noreferrer"
            class="inline-flex items-center justify-center h-9 rounded-full bg-green-600 text-white px-3 hover:bg-green-700 transition"
            title="WhatsApp"
            aria-label="Abrir WhatsApp"
          >
            <i data-lucide="message-circle" class="h-4 w-4"></i>
            <span class="hidden sm:inline text-xs ml-1">WhatsApp</span>
          </a>
          <button
            id="gallery-download"
            type="button"
            class="inline-flex items-center justify-center h-9 rounded-full bg-white/90 text-[color:var(--brand-primary)] border border-white hover:bg-white transition px-3"
            title="Descargar ficha (PDF)"
            aria-label="Descargar ficha"
          >
            <i data-lucide="download" class="h-4 w-4"></i>
            <span class="hidden sm:inline text-xs ml-1">Descargar ficha</span>
          </button>
          <button
            id="gallery-ficha-btn"
            type="button"
            class="inline-flex items-center justify-center h-9 rounded-full bg-white/90 text-[color:var(--brand-primary)] border border-white hover:bg-white transition px-3"
            title="Ficha"
            aria-label="Ver ficha"
          >
            <i data-lucide="file-text" class="h-4 w-4"></i>
            <span class="hidden sm:inline text-xs ml-1">Ficha</span>
          </button>
          <button
            id="gallery-close"
            type="button"
            class="inline-flex items-center justify-center h-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition px-3"
            aria-label="Cerrar"
            title="Cerrar"
          >
            <i data-lucide="x" class="h-4 w-4"></i>
            <span class="hidden sm:inline text-xs ml-1">Cerrar</span>
          </button>
        </div>

        <!-- Flechas -->
        <button
          id="gallery-prev"
          type="button"
          class="absolute left-3 md:left-6 top-1/2 -translate-y-1/2 inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition z-40"
          aria-label="Anterior"
          title="Anterior"
        >
          <i data-lucide="chevron-left" class="h-4 w-4"></i>
        </button>
        <button
          id="gallery-next"
          type="button"
          class="absolute right-3 md:right-6 top-1/2 -translate-y-1/2 inline-flex items-center justify-center h-9 w-9 rounded-full bg-white/90 text-black border border-white hover:bg-white transition z-40"
          aria-label="Siguiente"
          title="Siguiente"
        >
          <i data-lucide="chevron-right" class="h-4 w-4"></i>
        </button>

        <!-- Imagen -->
        <figure class="relative w-full max-w-5xl aspect-[16/10] md:aspect-[16/9] lg:aspect-[21/9]">
          <img id="gallery-img" src="" alt="" class="object-contain w-full h-full select-none bg-black" />
          <figcaption id="gallery-counter" class="absolute bottom-3 left-1/2 -translate-x-1/2 text-xs text-white/90 bg-black/40 px-2 py-1 rounded-md"></figcaption>
        </figure>

        <!-- Ficha compacta -->
        <div
          id="gallery-info"
          class="hidden absolute left-1/2 -translate-x-1/2 bottom-4 w-[95%] max-w-2xl rounded-lg border border-neutral-200 bg-white/95 backdrop-blur p-3 md:p-4 shadow-lg z-40"
        >
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 id="gallery-title" class="text-sm md:text-base font-medium tracking-tight"></h3>
              <p id="gallery-sub" class="text-xs text-neutral-600 mt-0.5"></p>
              <div class="mt-2 inline-flex items-center gap-2">
                <span id="gallery-badge-op" class="text-[10px] rounded-md bg-neutral-100 px-2 py-1"></span>
                <span id="gallery-badge-type" class="text-[10px] rounded-md bg-[color:var(--brand-primary)] text-white px-2 py-1"></span>
              </div>
            </div>
            <div class="text-[color:var(--brand-primary)] text-sm md:text-base font-semibold shrink-0" id="gallery-price"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Ficha pantalla completa -->
    <div id="detail-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="detail-title">
      <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
      <div class="relative mx-auto w-[96vw] max-w-4xl bg-white rounded-2xl shadow-xl border border-neutral-200 max-h-[92vh] overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="flex items-center justify-between px-4 h-12 border-b border-neutral-200 bg-white">
          <h3 id="detail-title" class="text-base font-medium line-clamp-1"></h3>
          <div class="flex items-center gap-2">
            <a id="detail-wa" href="#" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 h-9 px-3 rounded-md bg-green-600 text-white hover:bg-green-700 text-sm">
              <i data-lucide="message-circle" class="h-4 w-4"></i> WhatsApp
            </a>
            <button id="detail-open-gallery" type="button" class="inline-flex items-center gap-2 h-9 px-3 rounded-md border text-sm hover:bg-neutral-50">
              <i data-lucide="image" class="h-4 w-4"></i> Ver
            </button>
            <button id="detail-download" type="button" class="inline-flex items-center gap-2 h-9 px-3 rounded-md border text-sm hover:bg-neutral-50">
              <i data-lucide="download" class="h-4 w-4"></i> Descargar ficha
            </button>
            <button id="detail-close" type="button" class="inline-flex items-center justify-center h-9 w-9 rounded-full border hover:bg-neutral-50" aria-label="Cerrar">
              <i data-lucide="x" class="h-4 w-4"></i>
            </button>
          </div>
        </div>
        <!-- Body scrollable -->
        <div class="p-4 overflow-y-auto">
          <!-- Portada -->
          <div class="rounded-xl overflow-hidden border border-neutral-200 bg-neutral-50">
            <img id="detail-cover" src="" alt="" class="w-full h-full object-cover aspect-[4/3]" />
          </div>
          <!-- Meta -->
          <div class="mt-4 flex items-center justify-between gap-3">
            <div class="space-y-1">
              <p id="detail-location" class="flex items-center gap-1 text-neutral-700 text-sm">
                <i data-lucide="map-pin" class="h-4 w-4"></i>
                <span></span>
              </p>
              <div class="flex flex-wrap gap-2 text-xs">
                <span id="detail-badge-op" class="rounded-md bg-neutral-100 px-2 py-1"></span>
                <span id="detail-badge-type" class="rounded-md bg-neutral-900 text-white px-2 py-1"></span>
                <span id="detail-badge-status" class="hidden rounded-md bg-amber-100 text-amber-800 border border-amber-200 px-2 py-1"></span>
              </div>
            </div>
            <p id="detail-price" class="text-lg font-semibold text-[color:var(--brand-primary)]"></p>
          </div>
          <!-- Specs -->
          <ul id="detail-specs" class="mt-3 flex flex-wrap gap-x-4 gap-y-2 text-sm text-neutral-700"></ul>
          <!-- Features -->
          <div id="detail-features" class="mt-2 hidden">
            <h4 class="text-sm font-semibold mb-1">Características</h4>
            <div id="detail-features-list" class="flex flex-wrap gap-2 text-sm"></div>
          </div>
          <!-- Descripción -->
          <div id="detail-description" class="mt-3 hidden">
            <h4 class="text-sm font-semibold mb-1">Descripción</h4>
            <p id="detail-description-text" class="text-neutral-800 text-sm whitespace-pre-line"></p>
          </div>
          <!-- Datos de contacto -->
          <div class="mt-6 rounded-lg border border-neutral-200 bg-neutral-50 p-3 text-sm">
            <p class="font-medium">NGespacios — Natalia González</p>
            <p class="text-neutral-700">Martillera y Corredora Pública • Matrícula Nº 377-RP-21 Fº456 TºII</p>
            <p class="text-neutral-700">Email: <a href="mailto:nataliagonzalezmartillerapublica@ngespacios.com.ar" class="text-[color:var(--brand-primary)] hover:underline">nataliagonzalezmartillerapublica@ngespacios.com.ar</a></p>
            <p class="text-neutral-700">WhatsApp: <a href="https://wa.me/5492944635083" target="_blank" rel="noreferrer" class="text-[color:var(--brand-primary)] hover:underline">+54 9 294 463 5083</a></p>
            <p class="text-neutral-700">San Carlos de Bariloche, Río Negro, Argentina</p>
          </div>
        </div>
      </div>
    </div>

    <!-- JS: íconos, UI, galería, detalle, Admin oculto con clave -->
    <script>
      // Año
      document.getElementById('year').textContent = new Date().getFullYear();

      // Lucide icons
      const renderIcons = () => { if (window.lucide) window.lucide.createIcons(); };
      window.addEventListener('DOMContentLoaded', renderIcons);

      // Scroll suave para anclas
      document.querySelectorAll('a[href^="#"]').forEach((a) => {
        a.addEventListener('click', (e) => {
          const href = a.getAttribute('href');
          if (!href || href === '#') return;
          e.preventDefault();
          const el = document.querySelector(href);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      // Menú móvil
      const btnMobile = document.getElementById('btn-mobile');
      const mobileMenu = document.getElementById('mobile-menu');
      const toggleMenu = (open) => {
        const willOpen = typeof open === 'boolean' ? open : mobileMenu.classList.contains('hidden');
        mobileMenu.classList.toggle('hidden', !willOpen);
        btnMobile?.setAttribute('aria-expanded', String(willOpen));
        if (window.lucide) {
          btnMobile.innerHTML = willOpen ? '<i data-lucide="x" class="h-4 w-4"></i>' : '<i data-lucide="menu" class="h-4 w-4"></i>';
          window.lucide.createIcons();
        }
      };
      btnMobile?.addEventListener('click', () => toggleMenu());
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') toggleMenu(false); });
      mobileMenu?.querySelectorAll('a').forEach((link) => { link.addEventListener('click', () => toggleMenu(false)); });
      window.addEventListener('resize', () => { if (window.innerWidth >= 768) toggleMenu(false); });

      // --------------------------
      // Utilidades imágenes: normaliza URLs comunes que no cargan directo
      // --------------------------
      /**
       * @function normalizeImageUrl
       * @description Convierte enlaces de Google Drive / Dropbox a formato embebible.
       *  - Drive (file/d/ID/view) -> https://drive.google.com/uc?export=view&id=ID
       *  - Drive (?id=ID) -> uc?export=view&id=ID
       *  - Dropbox (...?dl=0) -> ...?raw=1
       */
      function normalizeImageUrl(url) {
        if (!url) return url;
        try {
          const u = new URL(url);
          // Google Drive variantes
          if (u.hostname.includes('drive.google.com')) {
            // /file/d/FILE_ID/view
            const m = u.pathname.match(/\\/file\\/d\\/([^/]+)\\/view/);
            const id = m ? m[1] : u.searchParams.get('id');
            if (id) return `https://drive.google.com/uc?export=view&id=${id}`;
          }
          // Dropbox forzar raw
          if (u.hostname.includes('dropbox.com')) {
            u.searchParams.set('raw', '1');
            u.searchParams.delete('dl');
            return u.toString();
          }
          return url;
        } catch {
          return url;
        }
      }

      // --------------------------
      // Galería
      // --------------------------
      const WA_PHONE = '5492944635083';
      function buildWaLink(meta) {
        const msg = `Hola Natalia, me interesa la propiedad "${meta.title}" (${meta.operation} - ${meta.type}) en ${meta.location}. Precio: ${meta.price}. ¿Podemos coordinar una visita? Gracias.`;
        return `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(msg)}`;
      }
      const galleryState = { images: [], index: 0, meta: { title: '', operation: '', type: '', location: '', price: '' }, infoOpen: false };
      const modal = document.getElementById('gallery-modal');
      const imgEl = document.getElementById('gallery-img');
      const counterEl = document.getElementById('gallery-counter');
      const closeBtn = document.getElementById('gallery-close');
      const prevBtn = document.getElementById('gallery-prev');
      const nextBtn = document.getElementById('gallery-next');
      const fichaBtn = document.getElementById('gallery-ficha-btn');
      const downloadBtn = document.getElementById('gallery-download');
      const infoPanel = document.getElementById('gallery-info');
      const waBtn = document.getElementById('gallery-wa');
      const titleEl = document.getElementById('gallery-title');
      const subEl = document.getElementById('gallery-sub');
      const priceEl = document.getElementById('gallery-price');
      const badgeOp = document.getElementById('gallery-badge-op');
      const badgeType = document.getElementById('gallery-badge-type');

      function updateGalleryUI() {
        if (!galleryState.images.length) return;
        imgEl.src = galleryState.images[galleryState.index];
        imgEl.alt = galleryState.meta.title || 'Imagen de propiedad';
        counterEl.textContent = (galleryState.index + 1) + ' / ' + galleryState.images.length;
        titleEl.textContent = galleryState.meta.title;
        subEl.textContent = galleryState.meta.location;
        priceEl.textContent = galleryState.meta.price;
        badgeOp.textContent = galleryState.meta.operation;
        badgeType.textContent = galleryState.meta.type;
        waBtn.href = buildWaLink(galleryState.meta);
        renderIcons();
      }
      function openGallery({ images, meta, startIndex = 0, openFicha = false }) {
        galleryState.images = images.map(normalizeImageUrl);
        galleryState.index = Math.max(0, Math.min(startIndex, images.length - 1));
        galleryState.meta = meta;
        galleryState.infoOpen = !!openFicha;
        infoPanel.classList.toggle('hidden', !galleryState.infoOpen);
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        updateGalleryUI();
      }
      function closeGallery() { modal.classList.add('hidden'); document.body.style.overflow = ''; }
      function prevImage() { if (!galleryState.images.length) return; galleryState.index = (galleryState.index - 1 + galleryState.images.length) % galleryState.images.length; updateGalleryUI(); }
      function nextImage() { if (!galleryState.images.length) return; galleryState.index = (galleryState.index + 1) % galleryState.images.length; updateGalleryUI(); }
      function toggleFicha() { galleryState.infoOpen = !galleryState.infoOpen; infoPanel.classList.toggle('hidden', !galleryState.infoOpen); }

      closeBtn.addEventListener('click', closeGallery);
      prevBtn.addEventListener('click', prevImage);
      nextBtn.addEventListener('click', nextImage);
      fichaBtn.addEventListener('click', () => {
        // Abrir vista detalle con la meta actual
        openDetail(currentDetailSource || lastOpenedProperty);
      });

      // --------------------------
      // Vista Detalle (Ficha pantalla completa)
      // --------------------------
      /**
       * @typedef {Object} CsvProperty
       * @property {string} id
       * @property {string} title
       * @property {string} operation
       * @property {string} type
       * @property {string} location
       * @property {string} price_label
       * @property {string} price_amount
       * @property {string} price_currency
       * @property {string} price_period
       * @property {string} bedrooms
       * @property {string} bathrooms
       * @property {string} garages
       * @property {string} area_m2
       * @property {string} lot_m2
       * @property {string} images
       * @property {string} features
       * @property {string} description
       * @property {string} status
       */

      const detailModal = document.getElementById('detail-modal');
      const detailTitle = document.getElementById('detail-title');
      const detailCover = document.getElementById('detail-cover');
      const detailLocationWrap = document.getElementById('detail-location');
      const detailLocationText = detailLocationWrap?.querySelector('span');
      const detailBadgeOp = document.getElementById('detail-badge-op');
      const detailBadgeType = document.getElementById('detail-badge-type');
      const detailBadgeStatus = document.getElementById('detail-badge-status');
      const detailPrice = document.getElementById('detail-price');
      const detailSpecs = document.getElementById('detail-specs');
      const detailFeatures = document.getElementById('detail-features');
      const detailFeaturesList = document.getElementById('detail-features-list');
      const detailDesc = document.getElementById('detail-description');
      const detailDescText = document.getElementById('detail-description-text');
      const detailClose = document.getElementById('detail-close');
      const detailOpenGallery = document.getElementById('detail-open-gallery');
      const detailDownload = document.getElementById('detail-download');
      const detailWa = document.getElementById('detail-wa');

      // Variables de estado para reusar en descargas/ver
      let lastOpenedProperty = null; // última propiedad abierta
      let currentDetailSource = null; // fuente actual para abrir detalle desde galería

      function formatPriceObj(p) {
        const label = p.price_label || '';
        if (label) return label;
        const amount = p.price_amount || '';
        const curr = (p.price_currency || '').toUpperCase();
        const period = p.price_period || '';
        let text = '';
        if (curr && amount) text = `${curr} ${amount}`;
        else if (amount) text = amount;
        if (period) text += ` ${period}`;
        return text || 'Consultar';
      }

      function parseImages(str) {
        return (str || '').split('|').map((s) => s.trim()).filter(Boolean).map(normalizeImageUrl);
      }

      /** Construye HTML de badges y specs para la ficha */
      function buildSpecs(p) {
        const items = [];
        if (p.bedrooms) items.push({ icon: 'bed', text: `${p.bedrooms} hab` });
        if (p.bathrooms) items.push({ icon: 'bath', text: `${p.bathrooms} baños` });
        if (p.garages) items.push({ icon: 'car', text: `${p.garages} coch` });
        if (p.area_m2) items.push({ icon: 'square', text: `${p.area_m2} m² cub.` });
        if (p.lot_m2) items.push({ icon: 'ruler', text: `${p.lot_m2} m² lote` });
        return items;
      }

      function hydrateDetail(p) {
        // Portada
        const images = parseImages(p.images);
        const cover = images[0] || 'https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/9c2d819e-9803-48cf-bd3e-07c6023fe3c8.jpg';

        detailTitle.textContent = p.title || 'Ficha';
        detailCover.src = cover;
        detailCover.alt = p.title || 'Ficha';
        detailLocationText.textContent = p.location || '';
        detailBadgeOp.textContent = p.operation || '';
        detailBadgeType.textContent = p.type || '';
        if (p.status && p.status.trim()) {
          detailBadgeStatus.textContent = p.status.trim();
          detailBadgeStatus.classList.remove('hidden');
        } else {
          detailBadgeStatus.classList.add('hidden');
        }
        detailPrice.textContent = formatPriceObj(p);

        // Specs
        detailSpecs.innerHTML = '';
        buildSpecs(p).forEach((s) => {
          const li = document.createElement('li');
          li.className = 'inline-flex items-center gap-1';
          li.innerHTML = `<i data-lucide="${s.icon}" class="h-4 w-4 text-neutral-600"></i><span>${s.text}</span>`;
          detailSpecs.appendChild(li);
        });

        // Features
        const feats = (p.features || '').split(';').map((x) => x.trim()).filter(Boolean);
        if (feats.length) {
          detailFeatures.classList.remove('hidden');
          detailFeaturesList.innerHTML = '';
          feats.forEach((f) => {
            const span = document.createElement('span');
            span.className = 'px-2 py-0.5 rounded-full bg-neutral-100 text-neutral-800 border border-neutral-200';
            span.textContent = f;
            detailFeaturesList.appendChild(span);
          });
        } else {
          detailFeatures.classList.add('hidden');
        }

        // Descripción
        if (p.description && p.description.trim()) {
          detailDesc.classList.remove('hidden');
          detailDescText.textContent = p.description.trim();
        } else {
          detailDesc.classList.add('hidden');
        }

        // Acciones
        const meta = {
          title: p.title || '',
          operation: p.operation || '',
          type: p.type || '',
          location: p.location || '',
          price: formatPriceObj(p),
        };
        detailWa.href = buildWaLink(meta);

        // Botones
        detailOpenGallery.onclick = () => {
          openGallery({ images: images.length ? images : [cover], meta, startIndex: 0, openFicha: false });
          currentDetailSource = p;
          closeDetail();
        };
        detailDownload.onclick = () => downloadFichaPDF(p);

        renderIcons();
      }

      function openDetail(p) {
        if (!p) return;
        lastOpenedProperty = p;
        hydrateDetail(p);
        detailModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
      function closeDetail() {
        detailModal.classList.add('hidden');
        document.body.style.overflow = '';
      }
      detailClose.addEventListener('click', closeDetail);
      // Cerrar con fondo y con Esc
      detailModal.addEventListener('click', (e) => {
        if (e.target === detailModal || e.target === detailModal.firstElementChild) closeDetail();
      });
      document.addEventListener('keydown', (e) => {
        // galería
        if (!modal.classList.contains('hidden')) {
          if (e.key === 'Escape') closeGallery();
          if (e.key === 'ArrowLeft') prevImage();
          if (e.key === 'ArrowRight') nextImage();
        }
        // detalle
        if (!detailModal.classList.contains('hidden')) {
          if (e.key === 'Escape') closeDetail();
        }
      });

      // Descargar ficha desde la galería
      downloadBtn.addEventListener('click', () => {
        if (currentDetailSource) downloadFichaPDF(currentDetailSource);
        else if (lastOpenedProperty) downloadFichaPDF(lastOpenedProperty);
      });

      /**
       * @function downloadFichaPDF
       * @description Abre una ventana imprimible con el contenido de la ficha. El usuario puede “Guardar como PDF”.
       * Incluye: portada + hasta 6 fotos, título, ubicación, badges, precio, specs, features, descripción y contacto.
       */
      function downloadFichaPDF(p) {
        const images = parseImages(p.images);
        const meta = {
          title: p.title || '',
          operation: p.operation || '',
          type: p.type || '',
          location: p.location || '',
          price: formatPriceObj(p),
        };
        const specs = buildSpecs(p);
        const feats = (p.features || '').split(';').map((x) => x.trim()).filter(Boolean);
        const cover = images[0] || 'https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/9c2d819e-9803-48cf-bd3e-07c6023fe3c8.jpg';

        const w = window.open('', '_blank', 'noopener,noreferrer');
        if (!w) return alert('Desbloqueá ventanas emergentes para descargar la ficha.');
        const doc = w.document;
        doc.write(`
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ficha — ${meta.title}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --brand: #572d30; --text:#111827; --muted:#6b7280; }
    body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); margin: 24px; }
    h1, h2, h3 { margin: 0 0 6px 0; }
    .header { display:flex; justify-content:space-between; align-items:flex-start; gap:16px; border-bottom:1px solid #e5e7eb; padding-bottom:10px; margin-bottom:12px; }
    .brand { display:flex; align-items:center; gap:10px; }
    .logo { width:28px; height:28px; border-radius:8px; background:var(--brand); color:#fff; display:grid; place-items:center; font-weight:600; }
    .badges { display:flex; flex-wrap:wrap; gap:6px; font-size:12px; }
    .badge { border:1px solid #e5e7eb; border-radius:999px; padding:2px 8px; }
    .badge-dark { background:#111827; color:#fff; }
    .price { color: var(--brand); font-weight:700; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .cover { width:100%; aspect-ratio:4/3; object-fit:cover; border:1px solid #e5e7eb; border-radius:8px; }
    .thumb { width:100%; aspect-ratio:4/3; object-fit:cover; border:1px solid #e5e7eb; border-radius:8px; }
    .section { margin-top:12px; }
    .muted { color: var(--muted); }
    .specs { display:flex; flex-wrap:wrap; gap:10px; font-size:14px; }
    .features { display:flex; flex-wrap:wrap; gap:6px; }
    .chip { background:#f3f4f6; border:1px solid #e5e7eb; border-radius:12px; padding:2px 8px; font-size:12px; }
    .contact { border-top:1px solid #e5e7eb; margin-top:14px; padding-top:8px; font-size:12px; }
    @media print {
      body { margin: 16px; }
      a { color: inherit; text-decoration: none; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div>
      <h1>${meta.title}</h1>
      <div class="muted">${meta.location || ''}</div>
      <div class="badges">
        ${meta.operation ? `<span class="badge">${meta.operation}</span>` : ''}
        ${meta.type ? `<span class="badge badge-dark">${meta.type}</span>` : ''}
        ${p.status ? `<span class="badge">${p.status}</span>` : ''}
      </div>
    </div>
    <div class="brand">
      <div class="logo">NG</div>
      <div>
        <div><strong>NGespacios — Natalia González</strong></div>
        <div class="muted" style="max-width:260px;">Martillera y Corredora Pública • Matrícula Nº 377-RP-21 Fº456 TºII</div>
      </div>
    </div>
  </div>

  <div class="grid">
    <img src="${cover}" class="cover" alt="Portada" />
    <div>
      <div class="price" style="margin-bottom:8px;">${meta.price}</div>
      <div class="specs">
        ${specs.map(s => `<span>• ${s.text}</span>`).join('')}
      </div>
      ${feats.length ? `<div class="section"><h3>Características</h3><div class="features">${feats.map(f=>`<span class="chip">${f}</span>`).join('')}</div></div>` : ''}
    </div>
  </div>

  ${p.description ? `<div class="section"><h3>Descripción</h3><div class="muted" style="white-space:pre-line">${(p.description || '').replace(/</g,'&lt;')}</div></div>` : ''}

  ${images.length > 1 ? `
  <div class="section">
    <h3>Fotos</h3>
    <div class="grid">
      ${images.slice(1, 7).map(src => `<img src="${src}" class="thumb" alt="Foto" />`).join('')}
    </div>
  </div>` : ''}

  <div class="contact">
    <div><strong>Contacto</strong></div>
    <div>Email: <a href="mailto:nataliagonzalezmartillerapublica@ngespacios.com.ar">nataliagonzalezmartillerapublica@ngespacios.com.ar</a></div>
    <div>WhatsApp: <a href="https://wa.me/5492944635083" target="_blank" rel="noreferrer">+54 9 294 463 5083</a></div>
    <div>San Carlos de Bariloche, Río Negro, Argentina</div>
  </div>
</body>
</html>
        `);
        doc.close();
        // Pequeño delay para asegurar render antes de imprimir
        setTimeout(() => { w.focus(); w.print(); }, 400);
      }

      // Cerrar al clickear fuera (overlay) en galería
      modal.addEventListener('click', (e) => {
        const isBackdrop = e.target === modal || e.target === modal.firstElementChild;
        if (isBackdrop) closeGallery();
      });

      // --------------------------
      // Admin oculto + CSV
      // --------------------------
      const LS_KEY_URL = 'ngespacios:csvUrl';
      const LS_KEY_AUTH = 'ngespacios:adminAuth';
      const ADMIN_PASSWORD = 'NGespacios2024'; // CAMBIAR por tu clave
      const AUTH_HOURS = 12;

      const adminPanel = document.getElementById('ng-admin-panel');
      const csvInput = document.getElementById('ng-csv-url');
      const adminMsg = document.getElementById('ng-admin-msg');
      const grid = document.getElementById('grid-propiedades');
      const gridEmpty = document.getElementById('grid-empty');

      function setAuth() {
        const until = Date.now() + AUTH_HOURS * 60 * 60 * 1000;
        localStorage.setItem(LS_KEY_AUTH, JSON.stringify({ until }));
      }
      function hasAuth() {
        try {
          const raw = localStorage.getItem(LS_KEY_AUTH);
          if (!raw) return false;
          const { until } = JSON.parse(raw);
          return Date.now() < Number(until);
        } catch { return false; }
      }
      function requireAuth(cb) {
        if (hasAuth()) return cb();
        const pass = prompt('Clave de admin');
        if (pass === ADMIN_PASSWORD) { setAuth(); cb(); }
        else { alert('Clave incorrecta'); }
      }

      function normalizeSheetUrlToCsv(url) {
        try {
          const u = new URL(url);
          if (u.hostname.includes('docs.google.com')) {
            if (u.pathname.endsWith('/pub')) { u.searchParams.set('output', 'csv'); return u.toString(); }
            if (u.pathname.includes('/export')) { u.searchParams.set('format', 'csv'); return u.toString(); }
          }
          return url;
        } catch { return url; }
      }
      function parseCSV(text) {
        const rows = [];
        let i = 0, field = '', row = [], inQuotes = false;
        const pushField = () => { row.push(field.replace(/""/g, '"')); field = ''; };
        const pushRow = () => { rows.push(row); row = []; };
        while (i < text.length) {
          const c = text[i];
          if (inQuotes) {
            if (c === '"') {
              if (text[i + 1] === '"') { field += '"'; i += 2; continue; }
              inQuotes = false; i++; continue;
            } else { field += c; i++; continue; }
          } else {
            if (c === '"') { inQuotes = true; i++; continue; }
            if (c === ',') { pushField(); i++; continue; }
            if (c === '\n') { pushField(); pushRow(); i++; continue; }
            if (c === '\r') { i++; continue; }
            field += c; i++;
          }
        }
        pushField();
        if (row.length > 1 || (row.length === 1 && row[0] !== '')) pushRow();
        if (!rows.length) return [];
        const headers = rows[0].map((h) => (h || '').trim().replace(/^\uFEFF/, ''));
        const data = [];
        for (let r = 1; r < rows.length; r++) {
          const values = rows[r];
          if (!values || !values.some((v) => (v || '').trim() !== '')) continue;
          const obj = {};
          headers.forEach((h, idx) => { obj[h] = (values[idx] || '').trim(); });
          data.push(obj);
        }
        return data;
      }
      async function fetchCsv(url) {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return res.text();
      }
      function formatPrice(p) {
        const label = p.price_label || '';
        if (label) return label;
        const amount = p.price_amount || '';
        const curr = (p.price_currency || '').toUpperCase();
        const period = p.price_period || '';
        let text = '';
        if (curr && amount) text = `${curr} ${amount}`;
        else if (amount) text = amount;
        if (period) text += ` ${period}`;
        return text || 'Consultar';
      }

      function createCard(p) {
        const images = parseImages(p.images);
        const src = images[0] || 'https://pub-cdn.sider.ai/u/U0Z6H6GX0R3/web-coder/68bc90b5d4f5bb9dcd3b8249/resource/9c2d819e-9803-48cf-bd3e-07c6023fe3c8.jpg';
        const meta = {
          title: (p.title || 'Sin título'),
          operation: p.operation || '',
          type: p.type || '',
          location: p.location || '',
          price: formatPrice(p),
        };

        const article = document.createElement('article');
        article.className = 'group rounded-xl border border-neutral-200 overflow-hidden bg-white shadow-sm hover:shadow-md transition';

        // Imagen/badges
        const imgWrap = document.createElement('div');
        imgWrap.className = 'relative h-48 w-full overflow-hidden';
        const img = document.createElement('img');
        img.src = src; img.alt = meta.title; img.className = 'object-cover h-full w-full';
        imgWrap.appendChild(img);
        const badges = document.createElement('div');
        badges.className = 'absolute top-3 left-3 flex gap-2';
        badges.innerHTML = `
          <span class="rounded-md bg-white/90 px-2 py-1 text-xs font-medium">${meta.operation}</span>
          <span class="rounded-md bg-[color:var(--brand-primary)] text-white px-2 py-1 text-xs font-medium">${meta.type}</span>
        `;
        imgWrap.appendChild(badges);

        // Clic en imagen → abrir galería (VER)
        const overlayBtn = document.createElement('button');
        overlayBtn.type = 'button';
        overlayBtn.className = 'absolute inset-0 z-10';
        overlayBtn.setAttribute('aria-label', 'Abrir galería');
        overlayBtn.addEventListener('click', () => {
          openGallery({ images: images.length ? images : [src], meta, startIndex: 0, openFicha: false });
          currentDetailSource = p;
        });
        imgWrap.appendChild(overlayBtn);
        article.appendChild(imgWrap);

        // Body
        const body = document.createElement('div');
        body.className = 'p-4';

        const title = document.createElement('h3');
        title.className = 'font-medium tracking-tight line-clamp-1';
        title.textContent = meta.title;
        body.appendChild(title);

        const sub = document.createElement('div');
        sub.className = 'mt-1 flex items-center gap-1 text-sm text-neutral-600';
        sub.innerHTML = `<i data-lucide="map-pin" class="h-4 w-4"></i><span class="line-clamp-1">${meta.location}</span>`;
        body.appendChild(sub);

        const specs = document.createElement('ul');
        specs.className = 'mt-3 flex flex-wrap gap-x-3 gap-y-2 text-xs text-neutral-700';
        const parts = [];
        if (p.bedrooms) parts.push(`<li class="inline-flex items-center gap-1"><i data-lucide="bed" class="h-4 w-4 text-neutral-600"></i><span>${p.bedrooms} hab</span></li>`);
        if (p.bathrooms) parts.push(`<li class="inline-flex items-center gap-1"><i data-lucide="bath" class="h-4 w-4 text-neutral-600"></i><span>${p.bathrooms} baños</span></li>`);
        if (p.garages) parts.push(`<li class="inline-flex items-center gap-1"><i data-lucide="car" class="h-4 w-4 text-neutral-600"></i><span>${p.garages} coch</span></li>`);
        if (p.area_m2) parts.push(`<li class="inline-flex items-center gap-1"><i data-lucide="square" class="h-4 w-4 text-neutral-600"></i><span>${p.area_m2} m² cub.</span></li>`);
        if (p.lot_m2) parts.push(`<li class="inline-flex items-center gap-1"><i data-lucide="ruler" class="h-4 w-4 text-neutral-600"></i><span>${p.lot_m2} m² lote</span></li>`);
        specs.innerHTML = parts.join('');
        body.appendChild(specs);

        const footer = document.createElement('div');
        footer.className = 'mt-3 flex items-center justify-between';
        const price = document.createElement('span');
        price.className = 'text-lg font-semibold text-[color:var(--brand-primary)]';
        price.textContent = meta.price;
        footer.appendChild(price);

        const actions = document.createElement('div');
        actions.className = 'flex gap-2';

        // WhatsApp
        const aWa = document.createElement('a');
        aWa.href = buildWaLink(meta); aWa.target = '_blank'; aWa.rel = 'noreferrer';
        aWa.className = 'text-sm rounded-md bg-[color:var(--brand-primary)] text-white px-3 py-1.5 hover:opacity-90 transition';
        aWa.textContent = 'WhatsApp';
        actions.appendChild(aWa);

        // VER (abre galería)
        const btnVer = document.createElement('button');
        btnVer.type = 'button';
        btnVer.className = 'text-sm rounded-md border border-[color:var(--brand-primary)] text-[color:var(--brand-primary)] px-3 py-1.5 hover:bg-[color:var(--brand-primary)] hover:text-white transition';
        btnVer.textContent = 'Ver';
        btnVer.addEventListener('click', () => {
          openGallery({ images: images.length ? images : [src], meta, startIndex: 0, openFicha: false });
          currentDetailSource = p;
        });
        actions.appendChild(btnVer);

        // FICHA (abre vista detalle con descripción)
        const btnFicha = document.createElement('button');
        btnFicha.type = 'button';
        btnFicha.className = 'text-sm rounded-md border border-neutral-300 text-neutral-800 px-3 py-1.5 hover:bg-neutral-50 transition';
        btnFicha.textContent = 'Ficha';
        btnFicha.addEventListener('click', () => openDetail(p));
        actions.appendChild(btnFicha);

        footer.appendChild(actions);
        body.appendChild(footer);
        article.appendChild(body);

        renderIcons();
        return article;
      }

      function renderToMainGrid(list) {
        grid.innerHTML = '';
        if (!list || !list.length) {
          gridEmpty.classList.remove('hidden');
          return;
        }
        gridEmpty.classList.add('hidden');
        list.forEach((p) => grid.appendChild(createCard(p)));
        renderIcons();
      }
      async function loadFrom(url) {
        try {
          adminMsg?.classList.remove('err'); adminMsg?.classList.add('hint');
          if (adminMsg) adminMsg.textContent = 'Cargando datos...';
          const normalized = normalizeSheetUrlToCsv(url);
          const text = await fetchCsv(normalized);
          const rows = parseCSV(text);
          const data = rows.filter((r) => (r.id || '').trim() && (r.title || '').trim());
          renderToMainGrid(data);
          if (adminMsg) adminMsg.textContent = 'Datos cargados en la sección Propiedades.';
        } catch (e) {
          console.error(e);
          renderToMainGrid([]);
          if (adminMsg) {
            adminMsg.classList.remove('hint'); adminMsg.classList.add('err');
            adminMsg.textContent = 'No se pudo cargar el CSV. Revisá el enlace o permisos.';
          }
        }
      }

      // Botones del panel (siempre requieren auth)
      document.getElementById('ng-btn-test')?.addEventListener('click', () => {
        requireAuth(() => {
          const v = (csvInput.value || '').trim();
          if (!v) { adminMsg.textContent = 'Pegá una URL de Google Sheets (CSV).'; return; }
          loadFrom(v);
        });
      });
      document.getElementById('ng-btn-save')?.addEventListener('click', () => {
        requireAuth(() => {
          const v = (csvInput.value || '').trim();
          if (!v) { adminMsg.textContent = 'Pegá una URL de Google Sheets (CSV).'; return; }
          localStorage.setItem(LS_KEY_URL, v);
          adminMsg.classList.remove('err'); adminMsg.classList.add('hint');
          adminMsg.textContent = 'Guardado en este navegador. Actualizando…';
          loadFrom(v);
        });
      });

      // Acceso secreto: 5 taps/clicks rápidos sobre el logo
      (function secretLogoAccess() {
        const logo = document.getElementById('logo');
        if (!logo) return;
        let taps = 0;
        let timer = null;
        const reset = () => { taps = 0; if (timer) { clearTimeout(timer); timer = null; } };
        logo.addEventListener('click', (e) => {
          taps++;
          if (taps === 1) { timer = setTimeout(reset, 2000); }
          if (taps >= 5) {
            reset();
            requireAuth(() => {
              const isHidden = adminPanel.classList.contains('hidden');
              if (isHidden) {
                adminPanel.classList.remove('hidden');
                csvInput?.focus();
              } else {
                adminPanel.classList.add('hidden');
              }
            });
          }
        });
      })();

      // Init
      (function init() {
        const saved = localStorage.getItem(LS_KEY_URL);
        if (saved) loadFrom(saved); else gridEmpty.classList.remove('hidden');

        try {
          const u = new URL(window.location.href);
          if (u.searchParams.get('admin') === '1') {
            requireAuth(() => {
              adminPanel.classList.remove('hidden');
              csvInput?.focus();
            });
          }
        } catch {}
      })();

      // Form contacto demo
      const form = document.getElementById('contact-form');
      const ok = document.getElementById('form-ok');
      form?.addEventListener('submit', (e) => {
        e.preventDefault();
        ok?.classList.remove('hidden');
        setTimeout(() => { form.reset(); }, 200);
      });
    </script>
  </body>
</html>
